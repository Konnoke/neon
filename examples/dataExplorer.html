<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <script src="http://localhost:8080/neon/js/neon.js" type="text/javascript"></script>
    <script src="lib/jquery.jsonview.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="lib/dataExplorer.css"/>
    <link rel="stylesheet" type="text/css" href="lib/jquery.jsonview.css"/>

    <script type="text/javascript">
        var _databaseType = neon.query.Connection.MONGO;
        var _url = "localhost";
        var _databaseName = "test";
        var _tableName = "earthquakes";
        var _limit = 1;
        var _connection = new neon.query.Connection();

        // Initialize with the databases
        var updateDatabases = function () {
            _connection.getDatabaseNames(function (databases) {
                $("#databases").empty();
                var numDatabases = databases.length;
                for (var ii = 0; ii < numDatabases; ii++) {
                    var buttonString = '<input type="button" value="' + databases[ii] + '" />)';
                    var newButton = $(buttonString).click(function (event) {
                        setDatabase(event);
                    });
                    $("#databases").append(newButton);
                }
            });
        };

        var setDatabase = function (event) {
            _databaseName = event.target.value;
            _connection.use(_databaseName);
            updateTables();
        };

        var updateTables = function () {
            _connection.getTableNames(function (tables) {
                $("#tables").empty();
                var numTables = tables.length;
                for (var ii = 0; ii < numTables; ii++) {
                    var buttonString = '<input type="button" value="' + tables[ii] + '" />)';
                    var newButton = $(buttonString).click(function (event) {
                        queryData(event);
                    });
                    $("#tables").append(newButton);
                }
            });
        };

        var queryData = function (event) {
            _tableName = event.target.value;
            var query = new neon.query.Query().selectFrom(_databaseName, _tableName).limit(_limit);
            $("#queryString").html("Query Result for database: '" + _databaseName + "',  table: '" + _tableName + "'");
            // $("#queryString").val("" + );
            _connection.executeQuery(query, function (result) {
                $("#formattedJson").JSONView(result.data);
            });
        };

        $(document).ready(function () {
            neon.SERVER_URL = "/neon";
            _connection.connect(_databaseType, _url);
            updateDatabases();
        });


    </script>
    <title>Simple Data Explorer</title>

</head>

<body>
<div id="header">Simple Data Explorer Page using Neon</div>
<div id="container">
    <div id="center" class="column">

        <p  id='queryString'>Query Result</p>
        <p id="formattedJson"></p>
    </div>
    <div id="left" class="column">
        <h2>Databases</h2>

        <p id="databases"></p>

        <h2>Tables</h2>

        <p id="tables"></p>
    </div>
</div>
<div id="footer">Copyright 2014. Next Century Corporation</div>
</body>
</html>
